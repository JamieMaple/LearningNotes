# SQL基础

>  http://blog.csdn.net/yutianzuijin/article/details/12243751

### 数据抽象共有三个层次：物理层、逻辑层和视图层

1. 逻辑层 — 使用的数据模型包括两类

-  概念数据模型 — 与人的思维表达方式比较接近 — 实体-联系模型（ERM）
-  逻辑数据模型 — 使得数据更适合用计算机加以表示
   1. 关系模型、面向对象模型、层次模型和网状模型
   2. 设计师构建数据库模式的方法通常是**首先使用E-R模型在高层对数据建模**，然后**再将其转变成关系模型**

2. 物理层使用的数据模型称为物理数据模型

-  数据结构、数据操作和完整性约束三部分组成

### 数据库语言

>  *根据功能不同，可以将数据库系统提供的语言分成三种类型*

-  数据定义语言(DDL  — **Data Definition Language** ），用于定义数据库模式；
-  数据操纵语言(DML — **Data Manipulation Language** ），用于对数据库进行查询和更新；
-  数据控制语言(DCL  — **Data Control Language** ），用于对数据进行权限管理

### 数据库模式

-  物理模式(内模式)     — 在物理层描述数据库中全体存储结构和存取方法
-  逻辑模式(概念模式)  — 则在逻辑层描述数据库中全体数据的逻辑结构和特征 
-  视图层

1. 在视图层也可分为若干模式，称为子模式(外模式)
2. 它描述了数据库用户能够看见和使用的局部数据的逻辑结构和特征。
3. 通常一个数据库只有一个物理模式和一个逻辑模式，但是子模式有若干个。

###  E-R图

1. 元素构成:
   -  矩形，代表实体型
   -  椭圆，代表属性
   -  菱形，代表联系
   -  线段，将属性和实体性相连，或将实体型和联系相连

### 关系模型

1. 组成
   -  关系数据结构
   -  关系操作集合
   -  关系完整性约束
      1. 定义三类完整性约束
         -  实体完整性
         -  参照完整性
         -  用户定义完整性
      2. 实体完整性规则
         -  关系的主码不能取空值
      3. 参照完整性规则
         -  外码必须是另一个表中主码的有效值，或者是“空值”
2. 常用关系操作
   -  选择、投影、连接、除、并、交、差等查询操作
   -  增加、删除、修改
3. 关系操作的特点
   -  集合操作方式，即操作的对象和结果都是集合
4. 关系操作可以使用两种方式定义：
   -  基于代数的定义称为关系代数；
   -  基于逻辑的定义称为关系演算。
   -  由于使用变量的不同，关系演算又分为元组关系演算和域关系演算。

### SQL

1. 关系数据库系统支持三级模式结构，
   -  其模式（数据库）
   -  外模式
   -  内模式中的基本对象有**表、视图和索引**
2. 因此SQL的数据定义功能包括模式定义、表定义、视图定义和索引定义。
3. SQL通常不提供修改模式定义、修改视图定义和修改索引定义。
4. 用户如果想修改这些对象，只能先将它们删除，然后再重建。

### 基本表的操作

1. 创建表

   ```sql
   create table 基本表名
   (列名类型，
   ……
   完整性约束，
   ……
   )
   ```

   >完整性约束主要有三种子句：主键子句（primary key）、外键子句（foreignkey）和检查子句（check）。

2. 修改表

   ```SQL
   alter  table  <基本表名>  add  <列名>  <类型>

   alter  table  <基本表名>  drop  <列名>  <类型>  
   [cascade | restrict]（cascade表示所有引用到该列的视图和约束也要一起自动删除；restrict表示在没有视图或约束引用该属性时，才能在本表中删除该列，否则拒绝删除。）

   alter  table  <基本表名>  modify  <列名>  <类型>
   ```

3. 撤销表

   ```sql
   drop  table  <基本表名>  [cascade | restrict]
   ```

### SQL查询

1. **where子句中可以使用下列运算符**

   >l  算术运算符
   >
   >l  逻辑运算符
   >
   >l  字符串匹配运算符，包括like，not like
   >
   >l  集合成员资格运算符，包括in，not in
   >
   >l  谓词，包括exists，all，some，unique
   >
   >l  聚合函数，包括avg，min，max，sum和count
   >
   >l  还可以是另一个select语句

2. **select语句完整语法**

   ```SQL
   select  目标表的列名或列表达式序列
           from 基本表名和（或）视图序列
           [where 行条件表达式]
           [group by  列名序列]
                  [having  组条件表达式]
           [order by 列名[asc | desc]]
   ```

3. **整个语句的执行过程如下**

   1)读取from子句中基本表、视图的数据，执行笛卡尔积操作；

   2)选取满足where子句中给出的条件表达式的元组；

   3)按group子句中指定列的值分组，同时提取满足having子句中组条件表达式的那些组；

   4)按select子句中给出的列名或列表达式求值输出；

   5)order子句对输出的目标表进行排序，按附加说明asc升序排列，或按desc降序排列。

